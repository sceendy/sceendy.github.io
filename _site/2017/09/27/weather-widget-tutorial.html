<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>JS tutorial #2 - a five day forecast widget | Cindy Juarez </title>
  <meta name="description" content="The world needs more beginning-to-end blogs on creating things like this player with HTML5/JS by @sceendy! Awesome. https://t.co/S87ekdB17l&mdash; Ben Lesh üõã...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://sceendy.com/2017/09/27/weather-widget-tutorial.html">
  <link rel="alternate" type="application/rss+xml" title="Cindy Juarez" href="http://sceendy.com/feed.xml">

  <link rel="icon" type="image/png" href="/assets/favicon.png">
</head>


  <body>

    <div class="container">
  <header class="row">
    <div class="column-one">
      <div class="u--text-center">
        <img src="/assets/cindy.jpg" alt="Cindy Juarez" class="img--circle-lg">
        <h1 class="u--text-pink">Hi, my name is Cindy Juarez.</h1>
        <h2 class="headline">I am a front-end engineer in ATX.</h2>
      </div>
    </div>
  </header>
  <div class="row">
    <nav class="column-one">
      <ul class="nav" role="navigation">
        <li class="nav__list-item">
          
            <a class="nav__link" href="/">About</a>
          
        </li>
        
          
            <li class="nav__list-item">

              
                <a class="nav__link" href="/blog/">Blog</a>

              
            </li>
          
        
          
        
          
        
          
            <li class="nav__list-item">

              
                <a class="nav__link" href="/work/">Work</a>

              
            </li>
          
        
      </ul>
    </nav>
  </div>
</div>


    <div class="container">
      <article class="component-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="row">
    <header class="column-one">
      <h3 class="u--margin-bottom--none">JS tutorial #2 - a five day forecast widget</h3>
      <time datetime="2017-09-27T10:46:00-05:00" itemprop="datePublished">Sep 27, 2017</time>
      
        <div class="tags">dev</div>
      
        <div class="tags">tutorial</div>
      
        <div class="tags">beginner js</div>
      
    </header>
  </div>
  <div class="row">
    <section class="column-one">
      <blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">The world needs more beginning-to-end blogs on creating things like this player with HTML5/JS by <a href="https://twitter.com/sceendy?ref_src=twsrc%5Etfw">@sceendy</a>! Awesome. <a href="https://t.co/S87ekdB17l">https://t.co/S87ekdB17l</a></p>&mdash; Ben Lesh üõãÔ∏èüëëüî• (@BenLesh) <a href="https://twitter.com/BenLesh/status/832066726422417408?ref_src=twsrc%5Etfw">February 16, 2017</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>Earlier this year, a <a href="/2017/01/29/a-basic-js-music-player.html">blog post</a> of mine got some attention from a Google engineer/RxJS development lead, Ben Lesh, which is pretty awesome. It remains my most read blog post, actually. I'd like to think people starting out with JavaScript found it useful since at the end they had something to show for it.</p>

<p>While I considered writing a part 2 where I'd have the music player interact with an open music API, the API's I looked at all required oAuth which some might find intimidating initially. Yes, oAuth is an incredibly common part of using open API's - but I would prefer to keep these tutorials pretty simple to cover the basics. Instead, I decided to make another common widget that would allow for me to make use of a simpler, open API.</p>

<h4>Overview</h4>

<p>Ah, the popular weather widget - you will find thousands of designs for them on <a href="https://dribbble.com/search?q=weather" target="_blank">dribbble</a>. For this widget, we will be using the <a href="http://openweathermap.org/forecast5">Open Weather Map API</a> to obtain their 5 day forecast data which we can render in our widget. For this example, I built out an existing design using HTML/CSS.</p>

<p><img src="https://i.imgur.com/woC7RA9.png" alt="Weather Widget Design" class="img--responsive" />
<br /></p>
<p>You can grab the <a href="https://jsfiddle.net/sceendy/nea4z7ff/embedded/css/" target="_blank">CSS for this (slightly modified) design</a> and use the following HTML:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"component__weather-box"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"component__weather-content"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"weather-content__overview"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"weather-content__temp"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"component__forecast-box"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
</div>

<h4>Variables</h4>
<p>Just like in the <a href="/2017/01/29/a-basic-js-music-player.html">music player tutorial</a>, elements will be stored in variables. The variables will be referenced later when you want to render the data. </p>

<p></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">CURRENT_LOCATION</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">'weather-content__overview'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
<span class="kr">const</span> <span class="nx">CURRENT_TEMP</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">'weather-content__temp'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
<span class="kr">const</span> <span class="nx">FORECAST</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">'component__forecast-box'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</code></pre>
</div>

<h4>Working with an application programming interface (API)</h4>
<p>Interacting with API's is an important part of web development. An API is essentially a messenger that receives requests and sends responses from the server. A <a href="https://www.youtube.com/watch?v=s7wmiS2mSXY" target="_blank">common, helpful analogy</a> is to think of an API as a waiter at a restaurant - the waiter (API) takes your request/order that tells the kitchen (system) and then delivers the food (response/data) back to you.</p>

<p>For this project, you will need to get an API key to access the Open Weather API. You can easily get your API key by <a href="https://home.openweathermap.org/users/sign_up" target="_blank">signing up</a>. An API key is a unique token that works as a method of authorization so that you can access the data from the API.</p>

<p>Once you've done that, store the API endpoint (a URL) for the <a href="http://openweathermap.org/forecast5" target="_blank">five day daily forecast</a> in a variable called <span class="code-inline">URL</span> and add your APP ID (your API key) to the API endpoint for the five day daily forecast for a city (I'm going to use Dallas). I've customized this endpoint to return 7 lines from the API call (<span class="code-inline">cnt=7</span>) and to use Fahrenheit (<span class="code-inline">units=imperial</span>). You can edit these parameters as you please by visiting the <a href="http://openweathermap.org/forecast5" target="_blank">API doc</a> to check the other options. Fill in the city and APP ID.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">URL</span> <span class="o">=</span> <span class="s2">"https://api.openweathermap.org/data/2.5/forecast/daily?"</span> <span class="o">+</span>
<span class="s2">"q=CITY&amp;cnt=7&amp;units=imperial&amp;APPID=YOUR_APP_ID"</span><span class="p">;</span>
</code></pre>
</div>

<p>Cool, now we know what we will be communicating with and how to access it.</p>

<h4>JavaScript: Fetch API</h4>
<p>The Fetch API provides you with a powerful JavaScript interface that gives you the ability to access and manipulate parts of a page easily. When making a request, a promise will be returned. A <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank">promise</a> allows you to trigger numerous requests at once and as they become ready, you can handle them. The promise will provide resolve and reject functions which you can call in the body based on the result. </p>

<p>TL;DR:</p>

<blockquote>A promise is an object that may produce a single value some time in the future: either a resolved value, or a reason that it‚Äôs not resolved (e.g., a network error occurred). <br />- <strong>Eric Elliott</strong></blockquote>

<p>We can write a very simple fetch request - it'll take the path for the resource (the variable we named <span class="code-inline">URL</span>) as the first parameter. The second parameter allows you to control some settings such as declaring the method and headers. We will use the <span class="code-inline">GET</span> method and include a <span class="code-inline">Headers</span> object. (We don't need to append anything to the headers here but <a href="https://developer.mozilla.org/en-US/docs/Web/API/Headers" target="_blank">there are actions</a> you could take if you wanted to.)</p>

<p>Once that call is made, it returns a promise containing the response object. Let's see how this works in practice. </p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getWeatherData</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Headers</span><span class="p">();</span>

  <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">URL</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">data</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The promise gets a <span class="code-inline">then</span> method which allows you to react to the promise. We call the result <span class="code-inline">data</span> in line 6 and return the data in JSON format. Now, we can call that function, and once the promise is fulfilled successfully, use that JSON.</p>

<p>Returned data from promise:<br /><br />
<img src="https://i.imgur.com/tSlVAfn.png" alt="Weather Data in JSON format" class="img--responsive" /></p>

<h4>JavaScript: The Promise</h4>

<p>Now that we have data, we want to attach a callback that passes that data so that we can start using it. We add a <span class="code-inline">then</span> method to the function and it will be passed the result of <span class="code-inline">data.json()</span> as <span class="code-inline">weatherData</span>.</p>

<p>Based on the design, we will want the name of the city, a description of the current weather, the current temperature, and the daily forecast (day + temp). We can store the relevant data as variables to be used in a function called <span class="code-inline">renderData()</span>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nx">getWeatherData</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">weatherData</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">city</span> <span class="o">=</span> <span class="nx">weatherData</span><span class="p">.</span><span class="nx">city</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">dailyForecast</span> <span class="o">=</span> <span class="nx">weatherData</span><span class="p">.</span><span class="nx">list</span><span class="p">;</span>

  <span class="nx">renderData</span><span class="p">(</span><span class="nx">city</span><span class="p">,</span> <span class="nx">dailyForecast</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>

<h4>JavaScript: Template Literals</h4>

<p>In the beginning of this post, we stored elements as variables. If you read Part One of this tutorial series, you are familiar with the <span class="code-inline">innerHTML</span> property that you can access on elements. This property allows you to get or set the HTML inside of the element. </p>

<p>In <span class="code-inline">renderData()</span>, you first store the weather for today to access it for the description and current temperature. As the design has the city name on the left with the description of the current weather below it, you want to write the HTML using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals" target="_blank">template literals</a>.</p>

<p>Template literals are string literals that allow you to embed expressions. Here (line 3), we place back-ticks instead of quotes in the <span class="code-inline">widgetHeader</span> identifier to include the data. You can write out HTML as you normally do and then use a dollar sign and curly braces to include the location (<span class="code-inline">${location}</span>) and current weather description (<span class="code-inline">${currentWeather.description}</span>). </p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nx">renderData</span> <span class="o">=</span> <span class="p">(</span><span class="nx">location</span><span class="p">,</span> <span class="nx">forecast</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">currentWeather</span> <span class="o">=</span> <span class="nx">forecast</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">weather</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="kr">const</span> <span class="nx">widgetHeader</span> <span class="o">=</span>
  <span class="err">`</span><span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">location</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/h1&gt;&lt;small&gt;${currentWeather.description}&lt;/</span><span class="nx">small</span><span class="o">&gt;</span><span class="err">`</span><span class="p">;</span>

  <span class="nx">CURRENT_TEMP</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span>
  <span class="err">`</span><span class="o">&lt;</span><span class="nx">i</span> <span class="kr">class</span><span class="o">=</span><span class="s2">"wi ${applyIcon(currentWeather.icon)}"</span><span class="o">&gt;&lt;</span><span class="sr">/i</span><span class="err">&gt;
</span>  <span class="nx">$</span><span class="p">{</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">forecast</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">temp</span><span class="p">.</span><span class="nx">day</span><span class="p">)}</span> <span class="o">&lt;</span><span class="nx">i</span> <span class="kr">class</span><span class="o">=</span><span class="s2">"wi wi-degrees"</span><span class="o">&gt;&lt;</span><span class="sr">/i&gt;`</span><span class="err">;
</span>
  <span class="nx">CURRENT_LOCATION</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">widgetHeader</span><span class="p">;</span>

  <span class="c1">// render each daily forecast</span>
  <span class="nx">forecast</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">day</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">day</span><span class="p">.</span><span class="nx">dt</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">days</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Sun'</span><span class="p">,</span> <span class="s1">'Mon'</span><span class="p">,</span> <span class="s1">'Tues'</span><span class="p">,</span> <span class="s1">'Wed'</span><span class="p">,</span> <span class="s1">'Thurs'</span><span class="p">,</span> <span class="s1">'Fri'</span><span class="p">,</span> <span class="s1">'Sat'</span><span class="p">];</span>
    <span class="kd">let</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">days</span><span class="p">[</span><span class="nx">date</span><span class="p">.</span><span class="nx">getDay</span><span class="p">()];</span>
    <span class="kd">let</span> <span class="nx">dayBlock</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"div"</span><span class="p">);</span>
    <span class="nx">dayBlock</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">'forecast__item'</span><span class="p">;</span>
    <span class="nx">dayBlock</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span>
      <span class="err">`</span><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">"forecast-item__heading"</span><span class="o">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">"forecast-item__info"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">i</span> <span class="kr">class</span><span class="o">=</span><span class="s2">"wi ${applyIcon(day.weather[0].icon)}"</span><span class="o">&gt;&lt;</span><span class="sr">/i</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">span</span> <span class="kr">class</span><span class="o">=</span><span class="s2">"degrees"</span><span class="o">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">day</span><span class="p">.</span><span class="nx">temp</span><span class="p">.</span><span class="nx">day</span><span class="p">)}</span>
      <span class="o">&lt;</span><span class="nx">i</span> <span class="kr">class</span><span class="o">=</span><span class="s2">"wi wi-degrees"</span><span class="o">&gt;&lt;</span><span class="sr">/i&gt;&lt;/</span><span class="nx">span</span><span class="o">&gt;&lt;</span><span class="sr">/div&gt;`</span><span class="err">;
</span>    <span class="nx">FORECAST</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">dayBlock</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Since our <span class="code-inline">forecast</span> argument is an array, we use the <span class="code-inline">forEach()</span> method to iterate once over each item in that array. As we iterate over each element (which we name <span class="code-inline">day</span>), we are doing several things:</p>
<ul>
  <li>Converting the unix timestamp (<span class="code-inline">day.dt</span>) to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank">an actual date</a></li>
  <li>Creating an array with the days of the week starting from Sunday</li>
  <li>Using the <span class="code-inline">getDay()</span> method on the date object, we get the day of the week (0-6)</li>
  <li>Get the index of the array from returned value of <span class="code-inline">getDay()</span> and store the day name</li>
</ul>

<p>Once we're done making new elements for each day that render the data, all that is left is using the <span class="code-inline">append()</span> method to insert our elements to the parent element (stored in <span class="code-inline">FORECAST</span>).</p>

<iframe width="100%" height="400" src="//jsfiddle.net/sceendy/nea4z7ff/embedded/result/dark/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

      <h4 class="u--text-center heading-blue-border">Have a question or comment?<br/>Ask me anything: <a href="http://twitter.com/home?status=@sceendy">@sceendy</a></h4>
    </section>
  </div>
  
  <div id="disqus_thread"></div>
  <script>
      var disqus_config = function () {
        this.page.url = 'http://www.sceendy.com/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };

      (function () {  // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');

        s.src = '//sceendyblog.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  

</article>

    </div>

    <footer class="u--text-center">
  <p>
    <a href="http://dribbble.com/sceendy" target="_blank" class="btn-social dribbble">dribbble</a>
    <a href="https://github.com/sceendy" target="_blank" class="btn-social github">github</a>
    <a href="http://codepen.io/sceendy/" target="_blank" class="btn-social codepen">codepen</a>
    <a href="https://bumpers.fm/u/cindy" target="_blank" class="btn-social bumpers">bumpers</a>
    <a href="https://www.linkedin.com/in/sceendy" target="_blank" class="btn-social linkedin">linkedin</a>
  </p>
</footer>

<script>
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
    function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
    e=o.createElement(i);r=o.getElementsByTagName(i)[0];
    e.src='//www.google-analytics.com/analytics.js';
    r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-25355768-1');ga('send','pageview');
  </script>

<script src="https://widget.battleforthenet.com/widget.js" async></script>


  </body>

</html>
